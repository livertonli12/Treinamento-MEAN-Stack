<!DOCTYPE html>
<html lang="en" data-ng-app="treinamento">
<head>
	<meta charset="UTF-8">
	<title>Treinamento MEAN Stack</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
</head>
<body data-ng-controller="ExemploController as Exemplo">
	<style>
		.center { 
			margin: 0 auto;
		}
		.c {
			cursor: pointer;
		}
	</style>

	<div class="container">
		<div class="row">
			<div class="col s12">
				<h1 class="center-align">{{ Exemplo.titulo }}</h1>
			</div>
		</div>

		<div class="row" >
			<form class="col s12">
				<div class="row">
					<div class="input-field col s12">
						<input placeholder="Nome do curso" type="text" data-ng-model="Exemplo.form.nome">
					</div>
				</div>
				<div class="row">
					<div class="input-field col s12">
						<input type="text" placeholder="Carga horária do curso"  data-ng-model="Exemplo.form.cargaHoraria">
					</div>
				</div>
				<div class="row">
					<button class="col s6 waves-effect green btn" data-ng-click="Exemplo.add(Exemplo.form)">Adicionar</button>
					<button class="col s6 waves-effect blue btn" data-ng-click="Exemplo.save(Exemplo.form)">Editar</button>
				</div>
			</form>
		</div>

		<div class="row">
			<input class="col s12" type="text" placeholder="Buscar" data-ng-model="searchCourse">
		</div>

		<span data-ng-init="predicate='nome'; reverse=true"></span>
		
		<div class="row">
			<table>
				<thead>
					<tr>
						<th></th>
						<th>
							<span data-ng-click="Exemplo.changeSorting(key)" class="c">Nome</span>
						</th>
						<th>
							<span data-ng-click="Exemplo.changeSorting('cargaHoraria')" class="c">Carga Horária</span>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr data-ng-repeat="curso in Exemplo.cursos | orderBy:predicate:reverse | filter:searchCourse">
						<td>
							<input type="checkbox" id="curso-{{$index}}" data-ng-model="curso.selecionado">
							<label for="curso-{{$index}}"></label>
						</td>
						<td>{{ curso.nome }}</td>
						<td>{{ curso.cargaHoraria }}</td>
						<td>
							<button class="btn btn-mini red waves-effect waves-light col s6" data-ng-click="Exemplo.removeByNome(curso.nome)">Remover</button>
							<button class="btn btn-mini blue waves-effect waves-light col s6" data-ng-click="Exemplo.edit(curso, $index)">Editar</button>
						</td>
					</tr>
				</tbody>
			</table>
			<button data-ng-show="Exemplo.cursos.length > 0" data-ng-click="Exemplo.removeAll(Exemplo.cursos)" class="btn btn-mini red waves waves-light col s12">Remover todos selecionados</button>
		</div>
	</div>	

	<script src="../vendor/angular/angular.min.js"></script>
	<script type="text/javascript">
		angular.module('treinamento', [])
			.controller('ExemploController', ExemploController);

		function ExemploController($scope){
			var vm = this;
			
			vm.titulo = "MEAN STACK";
			vm.cursos = [
				{ nome: 'MongoDB', cargaHoraria: 2 },
				{ nome: 'Node.JS', cargaHoraria: 2 },
				{ nome: 'Mongoose.JS', cargaHoraria: 1.5 }
			];		
			
			vm.changeSorting = changeSorting;
			function changeSorting(sort) {
				$scope.predicate = sort;
			};
			
			vm.add = add;
			function add(curso) {
				vm.cursos.push(angular.copy(curso));
			};

			vm.edit = edit;
			function edit(curso, index){
				vm.form = angular.copy(curso);
				vm.form.index = index;
			}

			vm.save = save;
			function save(curso, index){
				var cursos = vm.cursos.map(function(el, i){
					if (i === curso.index) {
						delete curso.index;
						return curso;
					}
					return el;
				});
				vm.cursos = cursos;
			}
			
			vm.removeByNome = removeByNome;
			function removeByNome(nomeDoCurso) {
				vm.cursos = vm.cursos.filter(function(elem){ return elem.nome !== nomeDoCurso; });
			};

			vm.removeAll = removeAll;
			function removeAll(cursos) {
				console.log(cursos);
				vm.cursos = cursos.filter(function(elem) { return !elem.selecionado });
			};
		}

		ExemploController.$inject = ["$scope"];
	</script>
</body>
</html>